<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Study Tracker v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981', // Emerald 500
                        secondary: '#ef4444', // Red 500
                        dark: 'black', // Gray 800
                        accent: '#f59e0b', // Amber 500
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .circular-chart {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 250px;
        }
        .circle-bg {
            fill: none;
            stroke: #e2e8f0;
            stroke-width: 2.5;
        }
        .circle {
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
            transition: stroke-dasharray 0.5s ease;
        }
        .percentage {
            fill: #1f2937;
            font-family: sans-serif;
            font-weight: bold;
            font-size: 0.5em;
            text-anchor: middle;
        }
        @keyframes progress {
            0% { stroke-dasharray: 0 100; }
        }
    </style>
</head>
<body class="bg-dark text-gray-800 min-h-screen font-sans">

    <nav class="bg-dark text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    <span class="font-bold text-xl tracking-tight">12LPA Roadmap Tracker</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="openSettings()" class="flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-gray-700 hover:bg-gray-600 focus:outline-none transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                        </svg>
                        Settings
                    </button>
                    <button onclick="resetData()" class="flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-secondary hover:bg-red-600 focus:outline-none transition">
                         Reset
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            
            <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center justify-center relative overflow-hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 self-start w-full border-b pb-2">Overall Consistency</h3>
                <div class="w-48">
                    <svg viewBox="0 0 36 36" class="circular-chart text-primary">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path id="progress-circle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke="currentColor" />
                        <text x="18" y="20.35" class="percentage" id="progress-text">0%</text>
                    </svg>
                </div>
                <p class="text-sm text-gray-500 mt-2 text-center">Consistency is key to cracking 12LPA!</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 flex flex-col justify-between">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Statistics</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Total Days Planned</span>
                        <span class="font-bold text-2xl text-dark" id="total-days-stat">0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Sessions Completed</span>
                        <span class="font-bold text-2xl text-primary" id="completed-stat">0</span>
                    </div>
                     <div class="flex justify-between items-center">
                        <span class="text-gray-600">Sessions Missed</span>
                        <span class="font-bold text-2xl text-secondary" id="missed-stat">0</span>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">Current Streak</span>
                        <span class="font-bold text-accent" id="streak-stat">0 Days</span>
                    </div>
                </div>
            </div>

             <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Active Rules</h3>
                <ul class="space-y-3 text-sm" id="rules-display">
                    </ul>
            </div>
        </div>

        <div class="bg-white shadow-xl rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Daily Attendance Log</h3>
                <div class="flex space-x-2 text-xs">
                    <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-emerald-100 border border-emerald-500 mr-1"></span> Done</span>
                    <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-100 border border-red-500 mr-1"></span> Missed</span>
                    <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-gray-200 mr-1"></span> Off/Skip</span>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200" id="tracker-table">
                    <thead class="bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-100 z-10 shadow-sm border-r">Date</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">DSA (2.5h)</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Sys Design (2.5h)</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">English (1h)</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Project AI (4h)</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Daily %</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="table-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="mt-4 flex justify-center">
            <button id="load-more-btn" class="text-sm text-gray-500 hover:text-gray-900 font-medium hidden">Load next 30 days...</button>
        </div>
    </main>

    <div id="settings-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg leading-6 font-medium text-gray-900 text-center mb-4">Plan Settings</h3>
                <form id="settings-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Start Date</label>
                        <input type="date" id="start-date-input" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Duration (Months)</label>
                        <select id="duration-input" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                            <option value="1">1 Month</option>
                            <option value="3">3 Months</option>
                            <option value="5">5 Months</option>
                            <option value="6">6 Months</option>
                        </select>
                    </div>

                    <div class="border-t pt-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Subject Frequency</label>
                        
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">Project AI</span>
                            <select id="project-freq" class="text-xs border-gray-300 rounded">
                                <option value="daily">Daily</option>
                                <option value="alt">Alternate Days</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">English</span>
                            <select id="english-freq" class="text-xs border-gray-300 rounded">
                                <option value="daily">Daily</option>
                                <option value="alt">Alternate Days</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex items-center justify-between pt-4">
                        <button type="button" onclick="closeSettings()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition">Cancel</button>
                        <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-emerald-600 transition">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const DEFAULT_CONFIG = {
            startDate: new Date().toISOString().split('T')[0],
            months: 5,
            rules: {
                project: 'alt', // 'daily', 'alt'
                english: 'alt', // 'daily', 'alt'
            }
        };

        let appState = {
            config: JSON.parse(JSON.stringify(DEFAULT_CONFIG)),
            attendance: {} // Format: "YYYY-MM-DD": { dsa: 1, sys: 0, ... }
        };

        const SUBJECTS = ['dsa', 'sys', 'english', 'project'];
        const SUB_LABELS = { dsa: 'DSA', sys: 'Sys Design', english: 'English', project: 'Project AI' };

        // --- Initialization ---
        function init() {
            const savedState = localStorage.getItem('studyTrackerState');
            if (savedState) {
                appState = JSON.parse(savedState);
            } else {
                // If first run, set english to start on day 2 (odd days) for alternating rhythm
                appState.config.englishOffset = 1; 
            }
            
            // Populate settings inputs
            document.getElementById('start-date-input').value = appState.config.startDate;
            document.getElementById('duration-input').value = appState.config.months;
            document.getElementById('project-freq').value = appState.config.rules.project;
            document.getElementById('english-freq').value = appState.config.rules.english;

            render();
        }

        // --- Core Logic ---
        function generateDates() {
            const dates = [];
            const start = new Date(appState.config.startDate);
            const daysToGen = appState.config.months * 30;

            for (let i = 0; i < daysToGen; i++) {
                let d = new Date(start);
                d.setDate(start.getDate() + i);
                dates.push({
                    dateObj: d,
                    dateStr: d.toISOString().split('T')[0],
                    dayIndex: i,
                    dayName: d.toLocaleDateString('en-US', { weekday: 'short' }),
                    isSunday: d.getDay() === 0
                });
            }
            return dates;
        }

        function isSubjectActive(subject, dateInfo) {
            if (dateInfo.isSunday) return false; // Sunday is Revision only (special handling)

            const { rules } = appState.config;
            
            // DSA & Sys Design are always daily (except Sunday)
            if (subject === 'dsa' || subject === 'sys') return true;

            // Project Rule
            if (subject === 'project') {
                if (rules.project === 'daily') return true;
                // Alternate: Active on Even days (0, 2, 4...)
                return dateInfo.dayIndex % 2 === 0;
            }

            // English Rule
            if (subject === 'english') {
                if (rules.english === 'daily') return true;
                // Alternate: Active on Odd days (1, 3, 5...)
                return dateInfo.dayIndex % 2 !== 0;
            }
            return true;
        }

        // --- Rendering ---
        function render() {
            const dates = generateDates();
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            // Stats Vars
            let totalSessions = 0;
            let completedSessions = 0;
            let missedSessions = 0;
            let currentStreak = 0;
            let streakBroken = false;

            // Render Rows
            dates.forEach(d => {
                const row = document.createElement('tr');
                
                // Styling for Sundays
                if (d.isSunday) row.classList.add('bg-amber-50');

                // Date Column
                const dateCell = `
                    <td class="px-6 py-4 whitespace-nowrap text-center border-r border-gray-200 ${d.isSunday ? 'bg-amber-50' : 'bg-white'} sticky left-0 z-0">
                        <div class="text-sm font-bold text-gray-900">${d.dateObj.toLocaleDateString('en-US', {day:'2-digit', month:'short'})}</div>
                        <div class="text-xs text-gray-500">${d.dayName}</div>
                    </td>
                `;

                let subjectCells = '';
                let dailyTotal = 0;
                let dailyCompleted = 0;

                // Sunday Logic: Single "Revision" Cell spanning
                if (d.isSunday) {
                    subjectCells = `
                        <td colspan="4" class="px-6 py-4 text-center text-sm font-bold text-amber-600 tracking-wider">
                            SUNDAY REVISION DAY
                        </td>
                    `;
                    // Sundays don't count towards standard stats in this simple model, or count as neutral
                } else {
                    // Standard Days
                    SUBJECTS.forEach(sub => {
                        const isActive = isSubjectActive(sub, d);
                        
                        if (!isActive) {
                            subjectCells += `<td class="px-6 py-4 bg-gray-100 text-center"><span class="text-xs text-gray-400">OFF</span></td>`;
                        } else {
                            totalSessions++;
                            // Get Status
                            const status = appState.attendance[d.dateStr]?.[sub]; 
                            // status: 1 (done), 0 (missed), undefined (pending)
                            
                            let btnClass = 'bg-white border-2 border-gray-200 text-gray-400';
                            let icon = '';

                            if (status === 1) {
                                btnClass = 'bg-emerald-100 border-2 border-emerald-500 text-emerald-700';
                                icon = '✓';
                                completedSessions++;
                                dailyTotal++;
                                dailyCompleted++;
                            } else if (status === 0) {
                                btnClass = 'bg-red-50 border-2 border-red-200 text-red-400';
                                icon = '✕';
                                missedSessions++;
                                dailyTotal++; // Used for daily % calculation even if 0
                            } else {
                                dailyTotal++; // Pending also counts towards potential
                            }

                            // Calculate Streak (Backwards from today would be better, but simplified logic here)
                            // Ideally streak is calc'd separately.

                            subjectCells += `
                                <td class="px-6 py-4 text-center">
                                    <button onclick="toggleStatus('${d.dateStr}', '${sub}')" 
                                        class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-200 hover:scale-110 focus:outline-none ${btnClass}">
                                        ${icon}
                                    </button>
                                </td>
                            `;
                        }
                    });
                }

                // Daily Percentage Column
                let dailyPct = 0;
                let pctClass = 'text-gray-400';
                if (d.isSunday) {
                    dailyPct = '-';
                } else {
                    dailyPct = dailyTotal > 0 ? Math.round((dailyCompleted / dailyTotal) * 100) + '%' : '0%';
                    if (parseInt(dailyPct) === 100) pctClass = 'text-emerald-600 font-bold';
                    else if (parseInt(dailyPct) > 0) pctClass = 'text-gray-700';
                }

                row.innerHTML = dateCell + subjectCells + `<td class="px-6 py-4 text-center text-sm ${pctClass}">${dailyPct}</td>`;
                tbody.appendChild(row);
            });

            // Update Stats
            updateDashboard(totalSessions, completedSessions, missedSessions);
            updateRulesList();
        }

        function toggleStatus(dateStr, subject) {
            if (!appState.attendance[dateStr]) {
                appState.attendance[dateStr] = {};
            }
            
            const current = appState.attendance[dateStr][subject];
            
            // Cycle: Pending (undefined/null) -> Done (1) -> Missed (0) -> Pending (null)
            if (current === 1) {
                appState.attendance[dateStr][subject] = 0;
            } else if (current === 0) {
                delete appState.attendance[dateStr][subject];
            } else {
                appState.attendance[dateStr][subject] = 1;
            }

            save();
            render();
        }

        function updateDashboard(total, completed, missed) {
            document.getElementById('total-days-stat').textContent = appState.config.months * 30;
            document.getElementById('completed-stat').textContent = completed;
            document.getElementById('missed-stat').textContent = missed;

            // Circular Graph
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const circle = document.getElementById('progress-circle');
            const text = document.getElementById('progress-text');
            
            // SVG Stroke Logic (Dasharray: value, 100)
            circle.setAttribute('stroke-dasharray', `${percentage}, 100`);
            
            // Color logic based on percentage
            if(percentage < 40) circle.style.stroke = '#ef4444'; // Red
            else if(percentage < 75) circle.style.stroke = '#f59e0b'; // Amber
            else circle.style.stroke = '#10b981'; // Green

            text.textContent = `${percentage}%`;
        }

        function updateRulesList() {
            const list = document.getElementById('rules-display');
            const r = appState.config.rules;
            
            let html = `
                <li class="flex items-center"><span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span>DSA: Daily (2 Questions)</li>
                <li class="flex items-center"><span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span>Sys Design: Daily</li>
                <li class="flex items-center"><span class="w-2 h-2 rounded-full ${r.project === 'alt' ? 'bg-amber-500' : 'bg-emerald-500'} mr-2"></span>Project: ${r.project === 'alt' ? 'Alternate Days' : 'Daily'}</li>
                <li class="flex items-center"><span class="w-2 h-2 rounded-full ${r.english === 'alt' ? 'bg-amber-500' : 'bg-emerald-500'} mr-2"></span>English: ${r.english === 'alt' ? 'Alternate Days' : 'Daily'}</li>
                <li class="flex items-center"><span class="w-2 h-2 rounded-full bg-red-400 mr-2"></span>Sunday: Revision Only</li>
            `;
            list.innerHTML = html;
        }

        // --- Settings & Persistence ---
        const modal = document.getElementById('settings-modal');
        const form = document.getElementById('settings-form');

        function openSettings() { modal.classList.remove('hidden'); }
        function closeSettings() { modal.classList.add('hidden'); }
        
        // Close modal on click outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeSettings();
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            appState.config.startDate = document.getElementById('start-date-input').value;
            appState.config.months = parseInt(document.getElementById('duration-input').value);
            appState.config.rules.project = document.getElementById('project-freq').value;
            appState.config.rules.english = document.getElementById('english-freq').value;
            
            save();
            render();
            closeSettings();
        });

        function save() {
            localStorage.setItem('studyTrackerState', JSON.stringify(appState));
        }

        function resetData() {
            if(confirm("Are you sure? This will wipe all progress.")) {
                localStorage.removeItem('studyTrackerState');
                location.reload();
            }
        }

        // Run Init
        init();

    </script>
</body>
</html>